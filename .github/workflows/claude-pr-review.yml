name: Claude PR Review

on:
  pull_request:
    types: [opened, synchronize, reopened]

jobs:
  review:
    runs-on: ubuntu-latest
    permissions:
      contents: read
      pull-requests: write

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: PR Review by Claude
        uses: anthropics/claude-code-action@v1
        with:
          anthropic_api_key: ${{ secrets.ANTHROPIC_API_KEY }}
          github_token: ${{ secrets.GITHUB_TOKEN }}
          prompt: |
            Analyse la Pull Request #${{ github.event.pull_request.number }} du repository ${{ github.repository }}.

            Tu es un expert en revue de code pour un projet Next.js + Strapi + Shopify.

            Concentre-toi sur:
            - Server vs Client Components
            - Optimisation images (next/image)
            - Performance et SEO
            - Typage TypeScript
            - Variables d'environnement pour secrets
            - Performance (bundle size, lazy loading)

            Donne une revue constructive avec: résumé, points positifs, problèmes potentiels, sécurité, performance, recommandations.
